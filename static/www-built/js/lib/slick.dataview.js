+function(u,x){"function"===typeof define&&define.amd?define(["jquery","./slick.core","./slick.groupitemmetadataprovider"],x):(u.Slick.Data=u.Slick.Data||{},u.Slick.Data.DataView=x(u.jQuery,u.Slick,u.Slick.Data.GroupItemMetadataProvider))}(this,function(u,x,ha){return function(y){function E(a){for(var b=a||0,c=f.length;b<c;b++){a=f[b][v];if(void 0===a)throw"Each data element must implement a unique 'id' property";r[a]=b}}function O(){return{pageSize:k,pageNum:w,totalRows:z,totalPages:k?Math.max(1,
Math.ceil(z/k)):1}}function U(a,b){H=b;I=a;J=null;!1===b&&f.reverse();f.sort(a);!1===b&&f.reverse();r={};E();m()}function V(a,b){H=b;J=a;I=null;var c=Object.prototype.toString;Object.prototype.toString="function"==typeof a?a:function(){return this[a]};!1===b&&f.reverse();f.sort();Object.prototype.toString=c;!1===b&&f.reverse();r={};E();m()}function K(a){y.groupItemMetadataProvider||(y.groupItemMetadataProvider=new ha);A=[];F=[];a=a||[];l=a instanceof Array?a:[a];for(a=0;a<l.length;a++){var b=l[a]=
u.extend(!0,{},ia,l[a]);b.getterIsAFn="function"===typeof b.getter;b.compiledAccumulators=[];for(var c=b.aggregators.length;c--;){var d=b.compiledAccumulators,e=c,h=P(b.aggregators[c].accumulate),h=new Function("_items","for (var "+h.params[0]+", _i\x3d0, _il\x3d_items.length; _i\x3c_il; _i++) {"+h.params[0]+" \x3d _items[_i]; "+h.body+"}");h.displayName=h.name="compiledAccumulatorLoop";d[e]=h}F[a]={}}m()}function Q(){if(!D){D={};for(var a=0,b=q.length;a<b;a++)D[q[a][v]]=a}}function W(a,b){if(null==
a)for(var c=0;c<l.length;c++)F[c]={},l[c].collapsed=b;else F[a]={},l[a].collapsed=b;m()}function L(a,b,c){F[a][b]=l[a].collapsed^c;m()}function X(a,b){for(var c,d,e=[],h=[],g,B=b?b.level+1:0,n=l[B],f=0,k=n.predefinedValues.length;f<k;f++)d=n.predefinedValues[f],c=h[d],c||(c=new x.Group,c.value=d,c.level=B,c.groupingKey=(b?b.groupingKey+":|:":"")+d,e[e.length]=c,h[d]=c);f=0;for(k=a.length;f<k;f++)g=a[f],d=n.getterIsAFn?n.getter(g):g[n.getter],c=h[d],c||(c=new x.Group,c.value=d,c.level=B,c.groupingKey=
(b?b.groupingKey+":|:":"")+d,e[e.length]=c,h[d]=c),c.rows[c.count++]=g;if(B<l.length-1)for(f=0;f<e.length;f++)c=e[f],c.groups=X(c.rows,c);e.sort(l[B].comparer);return e}function Y(a,b){b=b||0;for(var c=l[b],d=a.length,e;d--;)if(e=a[d],!e.collapsed||c.aggregateCollapsed)if(e.groups&&Y(e.groups,b+1),c.aggregators.length&&(c.aggregateEmpty||e.rows.length||e.groups&&e.groups.length)){for(var h=l[e.level],g=e.level==l.length,f=new x.GroupTotals,n=void 0,k=h.aggregators.length;k--;)n=h.aggregators[k],n.init(),
h.compiledAccumulators[k].call(n,!g&&h.aggregateChildGroups?e.groups:e.rows),n.storeResult(f);f.group=e;e.totals=f}}function Z(a,b){b=b||0;for(var c=l[b],d=c.collapsed,e=F[b],h=a.length,g;h--;)g=a[h],g.collapsed=d^e[g.groupingKey],g.title=c.formatter?c.formatter(g):g.value,g.groups&&(Z(g.groups,b+1),g.rows=[])}function aa(a,b){b=b||0;for(var c=l[b],d=[],e,h=0,g,f=0,k=a.length;f<k;f++){g=a[f];d[h++]=g;if(!g.collapsed){e=g.groups?aa(g.groups,b+1):g.rows;for(var m=0,p=e.length;m<p;m++)d[h++]=e[m]}g.totals&&
c.displayTotalsRow&&(!g.collapsed||c.aggregateCollapsed)&&(d[h++]=g.totals)}return d}function P(a){a=a.toString().match(/^function[^(]*\(([^)]*)\)\s*{([\s\S]*)}$/);return{params:a[1].split(","),body:a[2]}}function ja(a,b){for(var c=[],d=0,e=0,h=a.length;e<h;e++)C(a[e],b)&&(c[d++]=a[e]);return c}function ka(a,b,c){for(var d=[],e=0,h,g=0,f=a.length;g<f;g++)h=a[g],c[g]?d[e++]=h:C(h,b)&&(d[e++]=h,c[g]=!0);return d}function ba(a){D=null;if(p.isFilterNarrowing!=R.isFilterNarrowing||p.isFilterExpanding!=
R.isFilterExpanding)ca=[];if(C){var b=y.inlineFilters?da:ja,c=y.inlineFilters?ea:ka;p.isFilterNarrowing?t=b(t,M):p.isFilterExpanding?t=c(a,M,ca):p.isFilterUnchanged||(t=b(a,M))}else t=k?a:a.concat();k?(t.length<w*k&&(w=Math.floor(t.length/k)),b=t.slice(k*w,k*w+k)):b=t;z=a=t.length;a=b;A=[];l.length&&(A=X(a),A.length&&(Y(A),Z(A),a=aa(A)));var b=q,c=a,d,e,f,g=[];d=0;var B=c.length;p&&p.ignoreDiffsBefore&&(d=Math.max(0,Math.min(c.length,p.ignoreDiffsBefore)));p&&p.ignoreDiffsAfter&&(B=Math.min(c.length,
Math.max(0,p.ignoreDiffsAfter)));for(var n=d,m=b.length;n<B;n++)if(n>=m)g[g.length]=n;else if(d=c[n],e=b[n],l.length&&(f=d.__nonDataRow||e.__nonDataRow)&&d.__group!==e.__group||d.__group&&!d.equals(e)||f&&(d.__groupTotals||e.__groupTotals)||d[v]!=e[v]||G&&G[d[v]])g[g.length]=n;q=a;return g}function m(){if(!S){var a=q.length,b=z,c=ba(f,C);k&&z<w*k&&(w=Math.max(0,Math.ceil(z/k)-1),c=ba(f,C));G=null;R=p;p={};b!=z&&T.notify(O(),null,N);a!=q.length&&fa.notify({previous:a,current:q.length},null,N);0<c.length&&
ga.notify({rows:c},null,N)}}var N=this,v="id",f=[],q=[],r={},D=null,C=null,G=null,S=!1,H=!0,J,I,p={},R={},M,t=[],da,ea,ca=[],ia={getter:null,formatter:null,comparer:function(a,b){return a.value-b.value},predefinedValues:[],aggregators:[],aggregateEmpty:!1,aggregateCollapsed:!1,aggregateChildGroups:!1,collapsed:!1,displayTotalsRow:!0},l=[],A=[],F=[],k=0,w=0,z=0,fa=new x.Event,ga=new x.Event,T=new x.Event;y=u.extend(!0,{},{groupItemMetadataProvider:null,inlineFilters:!1},y);u.extend(this,{beginUpdate:function(){S=
!0},endUpdate:function(){S=!1;m()},setPagingOptions:function(a){void 0!=a.pageSize&&(w=(k=a.pageSize)?Math.min(w,Math.max(0,Math.ceil(z/k)-1)):0);void 0!=a.pageNum&&(w=Math.min(a.pageNum,Math.max(0,Math.ceil(z/k)-1)));T.notify(O(),null,N);m()},getPagingInfo:O,getItems:function(){return f},setItems:function(a,b){void 0!==b&&(v=b);f=t=a;r={};E();for(var c,d=0,e=f.length;d<e;d++)if(c=f[d][v],void 0===c||r[c]!==d)throw"Each data element must implement a unique 'id' property";m()},setFilter:function(a){C=
a;if(y.inlineFilters){a=P(C);var b=a.body.replace(/return false\s*([;}]|$)/gi,"{ continue _coreloop; }$1").replace(/return true\s*([;}]|$)/gi,"{ _retval[_idx++] \x3d $item$; continue _coreloop; }$1").replace(/return ([^;}]+?)\s*([;}]|$)/gi,"{ if ($1) { _retval[_idx++] \x3d $item$; }; continue _coreloop; }$2"),b="var _retval \x3d [], _idx \x3d 0; var $item$, $args$ \x3d _args; _coreloop: for (var _i \x3d 0, _il \x3d _items.length; _i \x3c _il; _i++) { $item$ \x3d _items[_i]; $filter$; } return _retval; ".replace(/\$filter\$/gi,
b),b=b.replace(/\$item\$/gi,a.params[0]),b=b.replace(/\$args\$/gi,a.params[1]);a=new Function("_items,_args",b);a.displayName=a.name="compiledFilter";da=a;a=P(C);b=a.body.replace(/return false\s*([;}]|$)/gi,"{ continue _coreloop; }$1").replace(/return true\s*([;}]|$)/gi,"{ _cache[_i] \x3d true;_retval[_idx++] \x3d $item$; continue _coreloop; }$1").replace(/return ([^;}]+?)\s*([;}]|$)/gi,"{ if ((_cache[_i] \x3d $1)) { _retval[_idx++] \x3d $item$; }; continue _coreloop; }$2");b="var _retval \x3d [], _idx \x3d 0; var $item$, $args$ \x3d _args; _coreloop: for (var _i \x3d 0, _il \x3d _items.length; _i \x3c _il; _i++) { $item$ \x3d _items[_i]; if (_cache[_i]) { _retval[_idx++] \x3d $item$; continue _coreloop; } $filter$; } return _retval; ".replace(/\$filter\$/gi,
b);b=b.replace(/\$item\$/gi,a.params[0]);b=b.replace(/\$args\$/gi,a.params[1]);a=new Function("_items,_args,_cache",b);a.displayName=a.name="compiledFilterWithCaching";ea=a}m()},sort:U,fastSort:V,reSort:function(){I?U(I,H):J&&V(J,H)},setGrouping:K,getGrouping:function(){return l},groupBy:function(a,b,c){null==a?K([]):K({getter:a,formatter:b,comparer:c})},setAggregators:function(a,b){if(!l.length)throw Error("At least one grouping must be specified before calling setAggregators().");l[0].aggregators=
a;l[0].aggregateCollapsed=b;K(l)},collapseAllGroups:function(a){W(a,!0)},expandAllGroups:function(a){W(a,!1)},collapseGroup:function(a){var b=Array.prototype.slice.call(arguments),c=b[0];1==b.length&&-1!=c.indexOf(":|:")?L(c.split(":|:").length-1,c,!0):L(b.length-1,b.join(":|:"),!0)},expandGroup:function(a){var b=Array.prototype.slice.call(arguments),c=b[0];1==b.length&&-1!=c.indexOf(":|:")?L(c.split(":|:").length-1,c,!1):L(b.length-1,b.join(":|:"),!1)},getGroups:function(){return A},getIdxById:function(a){return r[a]},
getRowById:function(a){Q();return D[a]},getItemById:function(a){return f[r[a]]},getItemByIdx:function(a){return f[a]},mapRowsToIds:function(a){for(var b=[],c=0;c<a.length;c++)a[c]<q.length&&(b[b.length]=q[a[c]][v]);return b},mapIdsToRows:function(a){var b=[];Q();for(var c=0;c<a.length;c++){var d=D[a[c]];null!=d&&(b[b.length]=d)}return b},setRefreshHints:function(a){p=a},setFilterArgs:function(a){M=a},refresh:m,updateItem:function(a,b){if(void 0===r[a]||a!==b[v])throw"Invalid or non-matching id";f[r[a]]=
b;G||(G={});G[a]=!0;m()},insertItem:function(a,b){f.splice(a,0,b);E(a);m()},addItem:function(a){f.push(a);E(f.length-1);m()},deleteItem:function(a){var b=r[a];if(void 0===b)throw"Invalid id";delete r[a];f.splice(b,1);E(b);m()},syncGridSelection:function(a,b){function c(){if(0<e.length){f=!0;var c=d.mapIdsToRows(e);b||(e=d.mapRowsToIds(c));a.setSelectedRows(c);f=!1}}var d=this,e=d.mapRowsToIds(a.getSelectedRows()),f;a.onSelectedRowsChanged.subscribe(function(b,c){f||(e=d.mapRowsToIds(a.getSelectedRows()))});
this.onRowsChanged.subscribe(c);this.onRowCountChanged.subscribe(c)},syncGridCellCssStyles:function(a,b){function c(a){e={};for(var b in a)e[q[b][v]]=a[b]}function d(){if(e){f=!0;Q();var c={},d;for(d in e){var k=D[d];void 0!=k&&(c[k]=e[d])}a.setCellCssStyles(b,c);f=!1}}var e,f;c(a.getCellCssStyles(b));a.onCellCssStylesChanged.subscribe(function(a,d){f||b==d.key&&d.hash&&c(d.hash)});this.onRowsChanged.subscribe(d);this.onRowCountChanged.subscribe(d)},getLength:function(){return q.length},getItem:function(a){return q[a]},
getItemMetadata:function(a){a=q[a];return void 0===a?null:a.__group?y.groupItemMetadataProvider.getGroupRowMetadata(a):a.__groupTotals?y.groupItemMetadataProvider.getTotalsRowMetadata(a):null},onRowCountChanged:fa,onRowsChanged:ga,onPagingInfoChanged:T})}});