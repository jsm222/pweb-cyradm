/*! 
 * jquery.event.drag - v 2.2
 * Copyright (c) 2010 Three Dub Media - http://threedubmedia.com
 * Open Source MIT License - http://threedubmedia.com/code/license
 */

(function(d){"function"===typeof define&&define.amd?define(["jquery"],d):d(jQuery)})(function(d){d.fn.drag=function(b,a,c){var e="string"==typeof b?b:"",h=d.isFunction(b)?b:d.isFunction(a)?a:null;0!==e.indexOf("drag")&&(e="drag"+e);c=(b==h?a:c)||{};return h?this.bind(e,c,h):this.trigger(e)};var h=d.event,g=h.special,c=g.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",noBubble:!0,add:function(b){var a=d.data(this,c.datakey),f=b.data||{};
a.related+=1;d.each(c.defaults,function(b,c){void 0!==f[b]&&(a[b]=f[b])})},remove:function(){--d.data(this,c.datakey).related},setup:function(){if(!d.data(this,c.datakey)){var b=d.extend({related:0},c.defaults);d.data(this,c.datakey,b);h.add(this,"touchstart mousedown",c.init,b);this.attachEvent&&this.attachEvent("ondragstart",c.dontstart)}},teardown:function(){(d.data(this,c.datakey)||{}).related||(d.removeData(this,c.datakey),h.remove(this,"touchstart mousedown",c.init),c.textselect(!0),this.detachEvent&&
this.detachEvent("ondragstart",c.dontstart))},init:function(b){if(!c.touched){var a=b.data,f;if(!(0!=b.which&&0<a.which&&b.which!=a.which||d(b.target).is(a.not)||a.handle&&!d(b.target).closest(a.handle,b.currentTarget).length)&&(c.touched="touchstart"==b.type?this:null,a.propagates=1,a.mousedown=this,a.interactions=[c.interaction(this,a)],a.target=b.target,a.pageX=b.pageX,a.pageY=b.pageY,a.dragging=null,f=c.hijack(b,"draginit",a),a.propagates&&((f=c.flatten(f))&&f.length&&(a.interactions=[],d.each(f,
function(){a.interactions.push(c.interaction(this,a))})),a.propagates=a.interactions.length,!1!==a.drop&&g.drop&&g.drop.handler(b,a),c.textselect(!1),c.touched?h.add(c.touched,"touchmove touchend",c.handler,a):h.add(document,"mousemove mouseup",c.handler,a),!c.touched||a.live)))return!1}},interaction:function(b,a){var f=d(b)[a.relative?"position":"offset"]()||{top:0,left:0};return{drag:b,callback:new c.callback,droppable:[],offset:f}},handler:function(b){var a=b.data;switch(b.type){case !a.dragging&&
"touchmove":b.preventDefault();case !a.dragging&&"mousemove":if(Math.pow(b.pageX-a.pageX,2)+Math.pow(b.pageY-a.pageY,2)<Math.pow(a.distance,2))break;b.target=a.target;c.hijack(b,"dragstart",a);a.propagates&&(a.dragging=!0);case "touchmove":b.preventDefault();case "mousemove":if(a.dragging){c.hijack(b,"drag",a);if(a.propagates){!1!==a.drop&&g.drop&&g.drop.handler(b,a);break}b.type="mouseup"}default:c.touched?h.remove(c.touched,"touchmove touchend",c.handler):h.remove(document,"mousemove mouseup",c.handler),
a.dragging&&(!1!==a.drop&&g.drop&&g.drop.handler(b,a),c.hijack(b,"dragend",a)),c.textselect(!0),!1===a.click&&a.dragging&&d.data(a.mousedown,"suppress.click",(new Date).getTime()+5),a.dragging=c.touched=!1}},hijack:function(b,a,f,e,g){if(f){var q=b.originalEvent,r=b.type,n=a.indexOf("drop")?"drag":"drop",l,p=e||0,k,m;e=isNaN(e)?f.interactions.length:e;b.type=a;b.originalEvent=null;f.results=[];do!(k=f.interactions[p])||"dragend"!==a&&k.cancelled||(m=c.properties(b,f,k),k.results=[],d(g||k[n]||f.droppable).each(function(e,
g){m.target=g;b.isPropagationStopped=function(){return!1};l=g?h.dispatch.call(g,b,m):null;!1===l?("drag"==n&&(k.cancelled=!0,--f.propagates),"drop"==a&&(k[n][e]=null)):"dropinit"==a&&k.droppable.push(c.element(l)||g);"dragstart"==a&&(k.proxy=d(c.element(l)||k.drag)[0]);k.results.push(l);delete b.result;if("dropinit"!==a)return l}),f.results[p]=c.flatten(k.results),"dropinit"==a&&(k.droppable=c.flatten(k.droppable)),"dragstart"!=a||k.cancelled||m.update());while(++p<e);b.type=r;b.originalEvent=q;return c.flatten(f.results)}},
properties:function(b,a,f){var e=f.callback;e.drag=f.drag;e.proxy=f.proxy||f.drag;e.startX=a.pageX;e.startY=a.pageY;e.deltaX=b.pageX-a.pageX;e.deltaY=b.pageY-a.pageY;e.originalX=f.offset.left;e.originalY=f.offset.top;e.offsetX=e.originalX+e.deltaX;e.offsetY=e.originalY+e.deltaY;e.drop=c.flatten((f.drop||[]).slice());e.available=c.flatten((f.droppable||[]).slice());return e},element:function(b){if(b&&(b.jquery||1==b.nodeType))return b},flatten:function(b){return d.map(b,function(a){return a&&a.jquery?
d.makeArray(a):a&&a.length?c.flatten(a):a})},textselect:function(b){d(document)[b?"unbind":"bind"]("selectstart",c.dontstart).css("MozUserSelect",b?"":"none");document.unselectable=b?"off":"on"},dontstart:function(){return!1},callback:function(){}};c.callback.prototype={update:function(){g.drop&&this.available.length&&d.each(this.available,function(b){g.drop.locate(this,b)})}};var q=h.dispatch;h.dispatch=function(b){if(0<d.data(this,"suppress."+b.type)-(new Date).getTime())d.removeData(this,"suppress."+
b.type);else return q.apply(this,arguments)};var r=h.fixHooks.touchstart=h.fixHooks.touchmove=h.fixHooks.touchend=h.fixHooks.touchcancel={props:"clientX clientY pageX pageY screenX screenY".split(" "),filter:function(b,a){if(a){var c=a.touches&&a.touches[0]||a.changedTouches&&a.changedTouches[0]||null;c&&d.each(r.props,function(a,d){b[d]=c[d]})}return b}};g.draginit=g.dragstart=g.dragend=c});